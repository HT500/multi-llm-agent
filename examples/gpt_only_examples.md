# GPTのみ系統の出力例

## 実行情報

- **実行日時**: 2025-12-22 15:59:12
- **質問**:  疾患と正常のscRNAから創薬標的を見つけたい。scRNAは疾患と正常の細胞分布が異なるため、どのように同一細胞をそろえて、DEGをとれば良いか？ 
- **統合方式**: weighted
- **信頼度**: 0.43
- **生成された回答数**: 3

## 使用モデルとreasoning.effortの組み合わせ

- GPT-mini + Thinking標準
- GPT-5.2 + Thinking標準
- GPT-pro Pro + Thinking高

## 各モデルの個別出力

### GPT-mini + Thinking標準

- **モデル**: `gpt-5-mini`
- **reasoning.effort**: `medium`
- **temperature**: `0.7`

良い問いです。疾患サンプルと正常サンプルで「細胞群（cell types / states）の分布」が大きく異なるとき、単純に全細胞で比較すると「サンプル間の組成差（composition）」や「統計的な擬相関（pseudoreplication）」により偽陽性／偽陰性が増えます。以下は実務でよく使われる考え方と推奨ワークフロー（方法＋代表的ツール）です。目的は「同一または対応する細胞群を揃えて（マッピング／注釈して）、適切にDEGを求める」ことです。

1) 前処理とQC（共通基盤）
- 各サンプルごとにQCを実施（細胞ごとの検出遺伝子数、UMI数、ミトコンドリアRNA比率など）。ダブルトなども除去（Scrublet, DoubletFinder）。
- 正常化は状況に応じて：SCTransform（Seurat）、scranのnormalize、あるいはscVIなどのモデル内正規化。重要なのはサンプル間で一貫した処理を行うこと。
- バッチやサンプルのメタ情報（ドナー、処理日、年齢、性別など）を記録しておく。

2) 細胞型の整合（マッピング／注釈）
狙い：疾患と正常で「同じ種類の細胞」を正しく対応づけること
- 参照ベースのラベル転移（reference mapping）を推奨：
  - 正常サンプルを高品質な参照（または公共のアノテーション済み参照）として扱い、疾患サンプルを参照空間にマッピングする。Seuratの「FindTransferAnchors」＋「TransferData」、scArches / scVI-tools / scANVIの「query→reference」アプローチが代表的。参照ベースだと「疾患固有の差」を無理に消してしまうリスクを下げられる。
- 統合（integration）を行う場合は注意：
  - CCA（Seurat）、Harmony、Scanorama、LIGER、scVI などがあるが、過度な補正で疾患固有の生物学を消してしまわないようにする（「補正で病変信号を奪わない」ことを常に確認）。
- マーカー遺伝子ベースでの注釈も併用：既知マーカーで手動確認（複数マーカーで確認）し、異なるツールでの注釈を突き合わせる。
- ラベル不確かなら、ラベルの“確信度（prediction score）”を見る／低確度は別に扱う。

3) 細胞数差（組成差）への対応（差異検出はDEだけではない）
- 細胞の比率（abundance）自体が重要なシグナルの場合、差分細胞数解析（differential abundance）を行う：
  - Milo, DAseq, edgeR/proportion-based methods, propeller など。
- ただし細胞数変化と遺伝子発現変化は別の問いとして扱う。

4) DEG解析：推奨は「pseudo-bulk」＋サンプル間の変動を考慮
- 理由：scRNAのセル単位での解析（各セルを独立とみなすWilcoxon等）は、同一サンプル内の細胞が独立でない（擬相関）ため偽陽性率が高くなる。サンプル間差（ドナー差）を適切に扱うにはpseudo-bulkが安定。
- pseudo-bulkのやり方：
  - 各サンプル（ドナー）ごとに「対応する細胞型だけ」を集めてカウントを合算（＝サンプル×細胞型ごとの合計カウント行列を作成）。
  - 得られた「疑似バルク」行列をedgeR/DESeq2/limma-voomなどの標準的なバルクRNAseqツールで解析し、ドナーを生物学的複製として処理して共変量（バッチ、年齢、性別等）をモデルに入れる。
  - ツールの例：muscatパッケージはscRNA pseudo-bulk化とDE解析のワークフローを提供。
- 細胞数が少ないサンプルやセル型数が不足している場合は注意（サンプル数が少ないと検出力低下）。この場合は慎重に設計・解釈する。

5) もしセル単位で解析するなら（補助的に）
- ランダム効果モデルを使って「サンプル」をランダムに含める：GLMM（例：MAST with random effects, mixed models）を用いる。ただし計算コストとパラメータ推定の安定性に注意。
- 単純なWilcoxonやネガティブ二項モデルは補助的に使えるが、結果の解釈は慎重に。

6) 共変量とバイアスの制御
- モデルに「ドナー／サンプルID」「バッチ」「細胞の品質指標（ミトコンドリア%等）」「年齢／性別」などを含める。
- 細胞周期の影響が問題なら回帰（ただし、生物学的関係を消さないように議論の上で）。

7) 細胞サブクラス・トランジション状態
- 大きな細胞型内で複数状態があればサブクラスタリングしてから各サブクラスタごとにpseudo-bulk DEを行う。トランジショナルな状態（例：病態に特有の中間状態）は重要な標的候補になる。

8) 多重検定・フィルタリング
- FDR補正（Benjamini-Hochberg等）を行い、発現の大きさ（logFC）と検出頻度（どのくらいの細胞で発現しているか）でフィルタリングする。小さなlogFCや極端に低頻度の遺伝子は信頼性が低い。

9) 結果の解釈と標的選定（ドラッグターゲット志向）
- 候補遺伝子をスコアリング：細胞型特異性（ターゲットが目的細胞で高発現か）、病変特異的発現（疾患で上昇か）、膜局在や分泌蛋白（薬剤化しやすい）、既知のドラッガビリティ（DrugBank, OpenTargetsなど）を確認。
- パスウェイ解析・ネットワーク解析（GSEA, Reactome等）で生物学的意義を確認。
- 細胞間シグナル伝達解析（CellPhoneDB, NicheNet）で、ターゲットがコミュニケーションに関与しているかを評価。
- 空間トランスクリプトミクスや免疫組織化学で局在を確認すると優先度が上がる。

10) 実用的なポイントと注意点（まとめ）
- 参照ベースでマッピング→ラベル転移→サンプルごとにcell-type毎にpseudo-bulk集計→DE解析（edgeR/DESeq2/limma）を強く推奨。
- 組成差そのものは別解析（DA解析）で扱う。DE解析と混同しない。
- 結果は複数手法で検証（pseudo-bulk vs mixed-model vs per-cell）し、一致するものを高信頼候補とする。
- 統計的な複雑さ（少ないドナー数、強いバッチ効果、細胞数の偏り）には特に注意。実験デザイン（十分なドナー数、多重化）は重要。

11) 代表的ツール一覧（参考）
- 前処理/注釈/統合：Seurat (FindTransferAnchors / SCTransform)、Scanpy, Harmony, Scanorama, scVI/scANVI, scArches
- pseudo-bulk & DE：muscat, edgeR, DESeq2, limma-voom
- per-cellモデル：MAST (with random effects)
- 差分アブンダンス：Milo, DAseq, diffcyt/propeller
- 受容体・リガンド解析：CellPhoneDB, NicheNet
- ターゲット解析補助：Open Targets, DrugBank, Human Protein Atlas（膜タンパクかどうか）

簡潔な推奨ワークフロー（実務向け）
1. 各サンプルでQC → 正規化（SCTransformなど）
2. 正常群を参照として確立。疾患サンプルを参照にマッピング（Seuratのラベル転移 or scANVI/scArches）
3. 細胞型ごと／サブクラスタごとに、サンプル単位でpseudo-bulkカウントを作成
4. edgeR/DESeq2/limmaでサンプル間のバッチや共変量をモデルに入れてDE解析
5. 差分アブンダンス解析を別に実施
6. 候補を生物学的にフィルタ（細胞特異性、膜局在、ドラッガビリティ）→ 実験的検証へ

必要なら、あなたのデータ（サンプル数、細胞数、既に使っているツール、目的とする標的の条件）を教えてください。具体的なコマンド例（Seurat/Scanpy/scVI→pseudo-bulk→edgeRなど）のサンプルパイプラインを提示できます。

### GPT-5.2 + Thinking標準

- **モデル**: `gpt-5.2`
- **reasoning.effort**: `medium`
- **temperature**: `0.7`

疾患と正常で **細胞分布（比率）が違う** scRNA-seq から創薬標的候補を得るときは、単純に全細胞をまとめてDEGを取るのではなく、

1) **「同一（同等）細胞集団」を定義してそこの発現差（DE）を見る**  
2) **細胞比率の変化（DA: differential abundance）自体も別問題として解析する**  

この2本立てにするのが基本です。以下に、同一細胞を揃える実務的なやり方を示します。

---

## 1. 「同一細胞」をどう揃えるか：基本方針
### 重要な考え方
- “揃える”とは **同じ細胞型/細胞状態のラベルを両条件で揃えて比較する** ことであって、疾患で増えた細胞を無理に消したり、割合を強制的に一致させることではありません。
- 疾患で新しい状態（活性化T細胞、IFN応答状態など）が出る場合、それを正常のどれかに押し込むと誤差が増えます。**「共通状態」と「疾患特異状態」を分けて扱う**のが安全です。

---

## 2. 実務フロー（推奨）
### Step A: サンプル単位（ドナー単位）を前提に設計
DEGで最も多い失敗は **細胞を独立サンプル扱いしてしまう（擬似反復）**ことです。  
創薬標的探索なら、基本は **ドナー（患者/健常者）単位で比較**できる設計が望ましいです。

---

### Step B: まずは細胞型注釈（annotation）を揃える
「同一細胞」を揃えるには、まず**統一した細胞型ラベル**が必要です。

**方法1：参照データを用いたラベル転写（推奨）**
- 既存の高品質参照（Cell Atlas等）に対して、疾患・正常をそれぞれ（または統合後）マッピングしてラベル付け
- scRNA注釈は生カウント行列ベースでもML/統計で高精度に行う研究が進んでいます（提示文献1の文脈：raw count matricesを入力とした注釈・統計/MLの発展）。  
  → 参照付き注釈は「同一細胞の揃え」を明確にしやすいです。

**方法2：統合（integration）してクラスタ→マーカーで注釈**
- Seurat integration / Harmony / scVI などで共同埋め込みを作り、クラスタに細胞型名を付与
- 注意：統合は「技術差」を消す目的。**疾患効果まで消してしまう設定**（強すぎる補正）は避ける。

**最低限の品質チェック**
- 各細胞型で既知マーカー（例：T細胞, B細胞, myeloid等）の整合性
- 条件で偏っていないか（“健常のみ出るT細胞”などは注釈不安定の可能性）

---

### Step C: 「比較可能な集団」を定義する（同一細胞を揃える核心）
細胞型ラベルが揃ったら、次のどれかで比較単位を作ります。

**(C1) 細胞型単位で揃える（最も一般的）**
- 例：CD4 T / CD8 T / B / Mono / DC …で分け、それぞれでDEG  
- 疾患で比率が変わっても、**同じ細胞型内**の発現差は比較可能

**(C2) 細胞状態（サブクラスター）まで揃える（推奨）**
- 同じ「CD4 T」でも naïve と effector で発現は全く違います  
- 疾患・正常混在で再クラスタリングして、  
  - 共通に存在する状態（shared states）
  - 疾患特異的に増える状態（disease-specific states）  
  を分けると、DEGが「状態差」なのか「疾患差」なのかが整理されます。

**(C3) 連続状態（trajectory / latent space）で揃える**
- 分化や活性化が連続的なら、擬似時間や潜在空間上で近い細胞同士をマッチングして比較  
- ただし実装が複雑で、創薬ターゲットの一次スクリーニングでは (C1)(C2) が現実的です。

---

## 3. DEGの取り方：細胞分布が違うときの定石
### 推奨：細胞型（または状態）ごとの **pseudobulk DEG**
**やり方**
1. 細胞型（状態）×ドナーごとに raw counts を合計（pseudobulk）
2. その行列に対して DESeq2 / edgeR などで「疾患 vs 正常」を比較
3. 共変量（性別、年齢、バッチ、処理日など）もモデルに入れる

**利点**
- ドナー単位の独立性が担保され、偽陽性が減る
- 細胞数の差（分布差）にも比較的強い（※極端に少ないと不安定）

**注意点**
- ある細胞型で、ある条件のドナーがほとんど細胞を持たない場合：pseudobulkが成立しにくい  
  → その細胞型は「存在差（DA）」が主で、DEの解釈は慎重に。

### 代替：単一細胞モデル（MASTなど）＋ドナー効果
- 細胞を使うが、ランダム効果などでドナー依存を吸収する
- 大規模では重くなることがある

---

## 4. 「細胞比率が違う」こと自体の解析（DEと分ける）
疾患で特定細胞が増える/減るのは重要な生物学です。これをDEGに混ぜると解釈が崩れます。

- **DA（differential abundance）解析**を別途行う  
  例：Milo、scCODA、DA-seq 等
- 結果として  
  - 「増える細胞（状態）」  
  - 「その細胞内で上がる遺伝子（DE）」  
  の両方が揃うと、創薬標的として説得力が増します（“増えていて、かつその集団で特異的に上がる”）。

---

## 5. よくある落とし穴と対策
1) **統合で疾患シグナルを消す**  
- 統合は最小限に。DEは可能なら「統合後の発現」ではなく、元のraw/正規化発現を用いる（pseudobulkならraw推奨）。

2) **細胞型がずれているのにDEを取る**  
- “Mono” と “DC” が混じっているだけでDEGが大量に出ます。  
  → マーカーで再点検、参照マッピングで補強。

3) **疾患特異状態を無理に正常に対応付ける**  
- “同一細胞がない”なら、「その状態の出現（DA）」と「状態内の特徴遺伝子」を別枠で提示する。

---

## 6. 創薬標的探索に繋げる実装イメージ（最短ルート）
1. 注釈（参照付き推奨）→ 細胞型/状態定義  
2. 細胞型/状態ごとに pseudobulk DEG（ドナー単位、共変量込み）  
3. DA解析で増減する集団を特定  
4. 優先順位付け  
   - “増える集団”で上がる遺伝子  
   - 細胞表面/分泌因子、経路（サイトカイン、チェックポイント等）  
   - 既知薬剤標的・drugability情報と統合

---

必要なら、あなたのデータ条件（ドナー数、疾患/正常のサンプル構成、バッチの有無、既知の主要細胞型、目的が「細胞表面標的」か「経路標的」か）を教えてください。  
それに合わせて「どの粒度（細胞型/状態）で揃えるべきか」「pseudobulkの最小細胞数/ドナー数の目安」「統合手法の設定方針」まで具体的に提案できます。

### GPT-pro Pro + Thinking高

- **モデル**: `gpt-5.2-pro`
- **reasoning.effort**: `high`
- **temperature**: `0.7`

疾患と正常で **細胞組成（どの細胞が何％いるか）** が違う scRNA-seq では、「同一細胞をそろえる＝同じ“細胞型/細胞状態”同士を対応づけて比較する」ことが本質です。やるべき解析は大きく **(A) 組成変化（Differential abundance）** と **(B) 同一細胞型内の発現変化（Differential expression）** の2本立てになります。以下に実務的な手順をまとめます。

---

## 1) まず結論：DEG は「同一細胞型（状態）内」で、できれば **擬似バルク（pseudobulk）** で取る
- 疾患と正常で細胞比率が違う状態で全細胞をまとめて DEG を取ると、**“細胞が増えた/減った”だけ** を発現変化と誤認しやすいです（組成交絡）。
- したがって基本は  
  1) **細胞型/状態を揃える（注釈・マッピング）**  
  2) **細胞型ごとに DEG**（サンプル/患者を単位に）  
  が最も安全です。

---

## 2) 「同一細胞を揃える」ための実装：注釈 → 参照へのマッピングが王道
### 2.1 参照（多くは正常）を作り、疾患をそこへ写像する
- 正常データ（もしくは外部の健常リファレンス）で **細胞型注釈が信頼できる参照** を作り、疾患データを **mapping（label transfer）** します。
- scRNA注釈は raw count 行列を入力に機械学習/統計/AIで行う方法が多数あり（ご提示の「raw count matrices を用いた注釈」の総説の論点）、参照ベース注釈は特に実務で安定します。

代表例（方針として覚えればOK）  
- Seurat anchors / Azimuth 系（参照→クエリのラベル転送）  
- scVI / scANVI（条件やバッチを共変量として持つ潜在変数モデル）  
- Harmony / MNN / Scanorama / LIGER（主に統合・整列）

### 2.2 統合（integration）は「可視化・クラスタ・注釈」のため。DE には“生”のカウントに戻る
- 統合後の補正済み発現をそのまま DEG に使うと、**疾患差まで消す/歪める** 危険があります。
- 実務では  
  - 統合：クラスタリング・注釈の整列に使用  
  - DEG：**元の raw count** を使い、サンプル（患者）を考慮した統計モデルで実施  
  が推奨です。

---

## 3) 細胞数が揃わない問題：同一細胞型内で「統計単位を患者にする」
疾患と正常で、たとえば T細胞が疾患で多い／少ない、という状況は普通に起きます。これ自体は重要な生物学（DA）ですが、DE では次のように処理します。

### 3.1 最優先：pseudobulk（患者×細胞型で合算）→ edgeR/DESeq2 など
**やり方**
1. 各患者ごと・各細胞型ごとに、raw count を遺伝子単位で合算（pseudobulk）
2. 「疾患 vs 正常」を **患者を独立サンプル** として比較（edgeR / DESeq2 / limma-voom など）
3. 共変量（年齢・性別・バッチ・採取部位など）もデザイン行列に入れる

**メリット**
- 「細胞が多い患者ほど有利」などの **擬似複製（pseudo-replication）** を避けられる  
- DE が安定しやすく、再現性も高い  
- 創薬標的探索（再現性重視）に向く

### 3.2 どうしても単一細胞レベルでやるなら：サンプルをランダム効果にする
- MAST 等で「患者IDをランダム効果」「UMI数などを共変量」にして推定  
- ただし実務では pseudobulk の方が解釈と再現性が良いことが多いです。

### 3.3 “揃える”ためのダウンサンプリングは補助的に
- 各条件で同一細胞型の細胞数を同数にランダムサンプリングして DEG、は可能ですが  
  - 情報を捨てる  
  - 乱数で結果が揺れる  
ので、基本は **pseudobulk＋患者数確保** をおすすめします。

---

## 4) 細胞型だけでなく「細胞状態」もズレるとき：状態の対応付けを作る
同じ「単球」でも疾患で活性化状態が増える等、“状態”の違いが大きい場合があります。

使える戦略
- **参照へのマッピング＋状態クラスタ**：統合空間でサブクラスタを作り、対応する状態同士で DE
- **近傍マッチング（kNN matching）/メタセル**：統合空間で似た細胞を束ね（メタセル化）、状態単位で比較
- **軌跡（trajectory）上での比較**：分化/活性化の連続軸（擬時間）に沿って差をモデル化

ポイント：  
「病気で出現する状態」が正常に存在しないなら、それは“揃える”のではなく **疾患特異的集団として別枠解析**（後述）に回すのが正しいです。

---

## 5) 疾患で新規に出る/消える細胞集団はどうする？
### 5.1 正常に存在しない集団（例：線維芽細胞の病的サブタイプ、疲弊T細胞など）
- 無理に正常のどれかに押し込まず、
  - その集団のマーカー
  - 上流転写因子/経路
  - リガンド‐受容体
  を解析して「何がその集団を駆動しているか」を取ります。
- 創薬標的としては **その集団で特異的に高い膜タンパク/受容体/キナーゼ** が狙いやすいです。

### 5.2 そもそも重要：DA（組成変化）も別途“主結果”として出す
- 「その細胞型が増えること自体」が疾患機序・標的になり得るため、  
  Milo / scCODA などの **differential abundance** を併用すると設計が締まります。

---

## 6) 実務パイプライン（推奨の最短ルート）
1. **QC**：低品質細胞・ダブレット・ミトコンドリア比・アンビエントRNA対策  
2. **参照作成（多くは正常）**：クラスタ→細胞型注釈（必要なら外部参照で補強）  
3. **疾患を参照へ mapping**：細胞型（＋可能なら状態）ラベルを付与  
4. **DA解析**：疾患で増減する細胞型/状態を定量  
5. **DE解析（細胞型/状態ごと）**：pseudobulk（患者×細胞型）→ edgeR/DESeq2  
   - デザインに患者背景・バッチ等を入れる  
6. **標的優先順位付け**：  
   - 再現性（別コホート/交差検証）  
   - 薬剤標的性（受容体、酵素、細胞表面など）  
   - 経路/ネットワーク（GSEA等）  
   - 細胞間相互作用（CellPhoneDB/NicheNet 等）で「上流」を絞る

---

## 7) よくある落とし穴（重要）
- **統合後の補正値でDEG** → 疾患差を消す危険  
- **細胞を統計的独立サンプル扱い** → 患者差を無視して偽陽性が増える  
- **“細胞型の定義”が条件で変わる** → 参照マッピングや状態定義の明文化が必要  
- **疾患特異的集団を無理に対応付け** → 生物学的に誤解釈

---

必要なら、あなたのデータ状況（患者数、バッチ構造、組織、10x/Smart-seq、疾患で増える主要細胞型、既存の注釈の有無）を教えてください。そこに合わせて「参照の作り方」「mapping手法の選択」「pseudobulkのデザイン式（共変量の入れ方）」まで具体案に落とし込めます。

## 統合後の出力

疾患と正常で **細胞組成（どの細胞が何％いるか）** が違う scRNA-seq では、「同一細胞をそろえる＝同じ“細胞型/細胞状態”同士を対応づけて比較する」ことが本質です。やるべき解析は大きく **(A) 組成変化（Differential abundance）** と **(B) 同一細胞型内の発現変化（Differential expression）** の2本立てになります。以下に実務的な手順をまとめます。

---

## 1) まず結論：DEG は「同一細胞型（状態）内」で、できれば **擬似バルク（pseudobulk）** で取る
- 疾患と正常で細胞比率が違う状態で全細胞をまとめて DEG を取ると、**“細胞が増えた/減った”だけ** を発現変化と誤認しやすいです（組成交絡）。
- したがって基本は  
  1) **細胞型/状態を揃える（注釈・マッピング）**  
  2) **細胞型ごとに DEG**（サンプル/患者を単位に）  
  が最も安全です。

---

## 2) 「同一細胞を揃える」ための実装：注釈 → 参照へのマッピングが王道
### 2.1 参照（多くは正常）を作り、疾患をそこへ写像する
- 正常データ（もしくは外部の健常リファレンス）で **細胞型注釈が信頼できる参照** を作り、疾患データを **mapping（label transfer）** します。
- scRNA注釈は raw count 行列を入力に機械学習/統計/AIで行う方法が多数あり（ご提示の「raw count matrices を用いた注釈」の総説の論点）、参照ベース注釈は特に実務で安定します。

代表例（方針として覚えればOK）  
- Seurat anchors / Azimuth 系（参照→クエリのラベル転送）  
- scVI / scANVI（条件やバッチを共変量として持つ潜在変数モデル）  
- Harmony / MNN / Scanorama / LIGER（主に統合・整列）

### 2.2 統合（integration）は「可視化・クラスタ・注釈」のため。DE には“生”のカウントに戻る
- 統合後の補正済み発現をそのまま DEG に使うと、**疾患差まで消す/歪める** 危険があります。
- 実務では  
  - 統合：クラスタリング・注釈の整列に使用  
  - DEG：**元の raw count** を使い、サンプル（患者）を考慮した統計モデルで実施  
  が推奨です。

---

## 3) 細胞数が揃わない問題：同一細胞型内で「統計単位を患者にする」
疾患と正常で、たとえば T細胞が疾患で多い／少ない、という状況は普通に起きます。これ自体は重要な生物学（DA）ですが、DE では次のように処理します。

### 3.1 最優先：pseudobulk（患者×細胞型で合算）→ edgeR/DESeq2 など
**やり方**
1. 各患者ごと・各細胞型ごとに、raw count を遺伝子単位で合算（pseudobulk）
2. 「疾患 vs 正常」を **患者を独立サンプル** として比較（edgeR / DESeq2 / limma-voom など）
3. 共変量（年齢・性別・バッチ・採取部位など）もデザイン行列に入れる

**メリット**
- 「細胞が多い患者ほど有利」などの **擬似複製（pseudo-replication）** を避けられる  
- DE が安定しやすく、再現性も高い  
- 創薬標的探索（再現性重視）に向く

### 3.2 どうしても単一細胞レベルでやるなら：サンプルをランダム効果にする
- MAST 等で「患者IDをランダム効果」「UMI数などを共変量」にして推定  
- ただし実務では pseudobulk の方が解釈と再現性が良いことが多いです。

### 3.3 “揃える”ためのダウンサンプリングは補助的に
- 各条件で同一細胞型の細胞数を同数にランダムサンプリングして DEG、は可能ですが  
  - 情報を捨てる  
  - 乱数で結果が揺れる  
ので、基本は **pseudobulk＋患者数確保** をおすすめします。

---

## 4) 細胞型だけでなく「細胞状態」もズレるとき：状態の対応付けを作る
同じ「単球」でも疾患で活性化状態が増える等、“状態”の違いが大きい場合があります。

使える戦略
- **参照へのマッピング＋状態クラスタ**：統合空間でサブクラスタを作り、対応する状態同士で DE
- **近傍マッチング（kNN matching）/メタセル**：統合空間で似た細胞を束ね（メタセル化）、状態単位で比較
- **軌跡（trajectory）上での比較**：分化/活性化の連続軸（擬時間）に沿って差をモデル化

ポイント：  
「病気で出現する状態」が正常に存在しないなら、それは“揃える”のではなく **疾患特異的集団として別枠解析**（後述）に回すのが正しいです。

---

## 5) 疾患で新規に出る/消える細胞集団はどうする？
### 5.1 正常に存在しない集団（例：線維芽細胞の病的サブタイプ、疲弊T細胞など）
- 無理に正常のどれかに押し込まず、
  - その集団のマーカー
  - 上流転写因子/経路
  - リガンド‐受容体
  を解析して「何がその集団を駆動しているか」を取ります。
- 創薬標的としては **その集団で特異的に高い膜タンパク/受容体/キナーゼ** が狙いやすいです。

### 5.2 そもそも重要：DA（組成変化）も別途“主結果”として出す
- 「その細胞型が増えること自体」が疾患機序・標的になり得るため、  
  Milo / scCODA などの **differential abundance** を併用すると設計が締まります。

---

## 6) 実務パイプライン（推奨の最短ルート）
1. **QC**：低品質細胞・ダブレット・ミトコンドリア比・アンビエントRNA対策  
2. **参照作成（多くは正常）**：クラスタ→細胞型注釈（必要なら外部参照で補強）  
3. **疾患を参照へ mapping**：細胞型（＋可能なら状態）ラベルを付与  
4. **DA解析**：疾患で増減する細胞型/状態を定量  
5. **DE解析（細胞型/状態ごと）**：pseudobulk（患者×細胞型）→ edgeR/DESeq2  
   - デザインに患者背景・バッチ等を入れる  
6. **標的優先順位付け**：  
   - 再現性（別コホート/交差検証）  
   - 薬剤標的性（受容体、酵素、細胞表面など）  
   - 経路/ネットワーク（GSEA等）  
   - 細胞間相互作用（CellPhoneDB/NicheNet 等）で「上流」を絞る

---

## 7) よくある落とし穴（重要）
- **統合後の補正値でDEG** → 疾患差を消す危険  
- **細胞を統計的独立サンプル扱い** → 患者差を無視して偽陽性が増える  
- **“細胞型の定義”が条件で変わる** → 参照マッピングや状態定義の明文化が必要  
- **疾患特異的集団を無理に対応付け** → 生物学的に誤解釈

---

必要なら、あなたのデータ状況（患者数、バッチ構造、組織、10x/Smart-seq、疾患で増える主要細胞型、既存の注釈の有無）を教えてください。そこに合わせて「参照の作り方」「mapping手法の選択」「pseudobulkのデザイン式（共変量の入れ方）」まで具体案に落とし込めます。

## 調査結果サマリー

- **論文数**: 50
- **データベース結果数**: 0
- **アプリケーション結果数**: 0

